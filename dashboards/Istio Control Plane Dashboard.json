{
  "kind": "Dashboard",
  "metadata": {
    "name": "1813f692a8e4ac77155348d4c7d2fba8",
    "createdAt": "2025-06-30T11:18:24.141056157Z",
    "updatedAt": "2025-06-30T11:18:24.141056157Z",
    "version": 0,
    "project": "istio"
  },
  "spec": {
    "display": {
      "name": "Istio Control Plane Dashboard"
    },
    "panels": {
      "0_0": {
        "kind": "Panel",
        "spec": {
          "display": {
            "name": "Pilot Versions",
            "description": "Version number of each running instance"
          },
          "plugin": {
            "kind": "TimeSeriesChart",
            "spec": {
              "legend": {
                "mode": "list",
                "position": "bottom",
                "values": []
              },
              "visual": {
                "areaOpacity": 0.1,
                "connectNulls": false,
                "display": "line",
                "lineWidth": 1
              }
            }
          },
          "queries": [
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "query": "sum by (tag) (istio_build{component=\"pilot\"})",
                    "seriesNameFormat": "Version ({{tag}})"
                  }
                }
              }
            }
          ]
        }
      },
      "1_0": {
        "kind": "Panel",
        "spec": {
          "display": {
            "name": "Memory Usage",
            "description": "Memory usage of each running instance"
          },
          "plugin": {
            "kind": "TimeSeriesChart",
            "spec": {
              "legend": {
                "mode": "table",
                "position": "bottom",
                "values": [
                  "last",
                  "max"
                ]
              },
              "visual": {
                "areaOpacity": 0.1,
                "connectNulls": false,
                "display": "line",
                "lineWidth": 1
              },
              "yAxis": {
                "format": {
                  "unit": "bytes"
                }
              }
            }
          },
          "queries": [
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource",
                      "name": "prometheus"
                    },
                    "query": "sum by (pod) (container_memory_working_set_bytes{container=\"discovery\",pod=~\"istiod-.*\"})",
                    "seriesNameFormat": "Container ({{pod}})"
                  }
                }
              }
            },
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "query": "sum by (pod) (go_memstats_stack_inuse_bytes{app=\"istiod\"})",
                    "seriesNameFormat": "Stack ({{pod}})"
                  }
                }
              }
            },
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "query": "sum by (pod) (go_memstats_heap_inuse_bytes{app=\"istiod\"})",
                    "seriesNameFormat": "Heap (In Use) ({{pod}})"
                  }
                }
              }
            },
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "query": "sum by (pod) (go_memstats_heap_alloc_bytes{app=\"istiod\"})",
                    "seriesNameFormat": "Heap (Allocated) ({{pod}})"
                  }
                }
              }
            }
          ]
        }
      },
      "1_1": {
        "kind": "Panel",
        "spec": {
          "display": {
            "name": "Memory Allocations",
            "description": "Details about memory allocations"
          },
          "plugin": {
            "kind": "TimeSeriesChart",
            "spec": {
              "legend": {
                "mode": "table",
                "position": "bottom",
                "values": [
                  "last",
                  "max"
                ]
              },
              "visual": {
                "areaOpacity": 0.1,
                "connectNulls": false,
                "display": "line",
                "lineWidth": 1
              },
              "yAxis": {
                "format": {
                  "unit": "bytes/sec"
                }
              }
            }
          },
          "queries": [
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "query": "sum by (pod) (rate(go_memstats_alloc_bytes_total{app=\"istiod\"}[$__rate_interval]))",
                    "seriesNameFormat": "Bytes ({{pod}})"
                  }
                }
              }
            },
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource",
                      "name": "$datasource"
                    },
                    "query": "sum by (pod) (rate(go_memstats_mallocs_total{app=\"istiod\"}[$__rate_interval]))",
                    "seriesNameFormat": "Objects ({{pod}})"
                  }
                }
              }
            }
          ]
        }
      },
      "1_2": {
        "kind": "Panel",
        "spec": {
          "display": {
            "name": "CPU Usage",
            "description": "CPU usage of each running instance"
          },
          "plugin": {
            "kind": "TimeSeriesChart",
            "spec": {
              "legend": {
                "mode": "table",
                "position": "bottom",
                "values": [
                  "last",
                  "max"
                ]
              },
              "visual": {
                "areaOpacity": 0.1,
                "connectNulls": false,
                "display": "line",
                "lineWidth": 1
              }
            }
          },
          "queries": [
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "query": "sum by (pod) (irate(container_cpu_usage_seconds_total{container=\"discovery\",pod=~\"istiod-.*\"}[$__rate_interval]))",
                    "seriesNameFormat": "Container ({{pod}})"
                  }
                }
              }
            }
          ]
        }
      },
      "1_3": {
        "kind": "Panel",
        "spec": {
          "display": {
            "name": "Goroutines",
            "description": "Goroutine count for each running instance"
          },
          "plugin": {
            "kind": "TimeSeriesChart",
            "spec": {
              "legend": {
                "mode": "table",
                "position": "bottom",
                "values": [
                  "last",
                  "max"
                ]
              },
              "visual": {
                "areaOpacity": 0.1,
                "connectNulls": false,
                "display": "line",
                "lineWidth": 1
              }
            }
          },
          "queries": [
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "query": "sum by (pod) (go_goroutines{app=\"istiod\"})",
                    "seriesNameFormat": "Goroutines ({{pod}})"
                  }
                }
              }
            }
          ]
        }
      },
      "2_0": {
        "kind": "Panel",
        "spec": {
          "display": {
            "name": "XDS Pushes"
          },
          "plugin": {
            "kind": "TimeSeriesChart",
            "spec": {
              "legend": {
                "mode": "list",
                "position": "bottom",
                "values": []
              },
              "visual": {
                "areaOpacity": 1,
                "connectNulls": false,
                "display": "bar",
                "lineWidth": 1,
                "stack": "all"
              }
            }
          },
          "queries": [
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource",
                      "name": "prometheus"
                    },
                    "query": "sum by (type) (irate(pilot_xds_pushes[$__rate_interval]))",
                    "seriesNameFormat": "{{type}}"
                  }
                }
              }
            }
          ]
        }
      },
      "2_1": {
        "kind": "Panel",
        "spec": {
          "display": {
            "name": "Events",
            "description": "Size of each xDS push.\n"
          },
          "plugin": {
            "kind": "TimeSeriesChart",
            "spec": {
              "legend": {
                "mode": "table",
                "position": "bottom",
                "values": [
                  "last",
                  "max"
                ]
              },
              "visual": {
                "areaOpacity": 0.1,
                "connectNulls": false,
                "display": "line",
                "lineWidth": 1
              }
            }
          },
          "queries": [
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "query": "sum by (type,event) (rate(pilot_k8s_reg_events[$__rate_interval]))",
                    "seriesNameFormat": "{{event}} {{type}}"
                  }
                }
              }
            },
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource",
                      "name": "$datasource"
                    },
                    "query": "sum by (type,event) (rate(pilot_k8s_cfg_events[$__rate_interval]))",
                    "seriesNameFormat": "{{event}} {{type}}"
                  }
                }
              }
            },
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "query": "sum by (type) (rate(pilot_push_triggers[$__rate_interval]))",
                    "seriesNameFormat": "Push {{type}}"
                  }
                }
              }
            }
          ]
        }
      },
      "2_2": {
        "kind": "Panel",
        "spec": {
          "display": {
            "name": "Connections",
            "description": "Total number of XDS connections\n"
          },
          "plugin": {
            "kind": "TimeSeriesChart",
            "spec": {
              "legend": {
                "mode": "table",
                "position": "bottom",
                "values": [
                  "last",
                  "max"
                ]
              },
              "visual": {
                "areaOpacity": 0.1,
                "connectNulls": false,
                "display": "line",
                "lineWidth": 1
              }
            }
          },
          "queries": [
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "query": "sum(envoy_cluster_upstream_cx_active{cluster_name=\"xds-grpc\"})",
                    "seriesNameFormat": "Connections (client reported)"
                  }
                }
              }
            },
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource",
                      "name": "$datasource"
                    },
                    "query": "sum (pilot_xds)",
                    "seriesNameFormat": "Connections (server reported)"
                  }
                }
              }
            }
          ]
        }
      },
      "2_3": {
        "kind": "Panel",
        "spec": {
          "display": {
            "name": "Push Errors",
            "description": "Number of push errors. Many of these are at least potentional fatal and should be explored in-depth via Istiod logs.\nNote: metrics here do not use rate() to avoid missing transition from \"No series\"; series are not reported if there are no errors at all.\n"
          },
          "plugin": {
            "kind": "TimeSeriesChart",
            "spec": {
              "legend": {
                "mode": "table",
                "position": "bottom",
                "values": [
                  "last",
                  "max"
                ]
              },
              "visual": {
                "areaOpacity": 0.1,
                "connectNulls": false,
                "display": "line",
                "lineWidth": 1
              }
            }
          },
          "queries": [
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "query": "sum by (type) (pilot_total_xds_rejects)",
                    "seriesNameFormat": "Rejected Config ({{type}})"
                  }
                }
              }
            },
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "query": "pilot_total_xds_internal_errors",
                    "seriesNameFormat": "Internal Errors"
                  }
                }
              }
            }
          ]
        }
      },
      "3_0": {
        "kind": "Panel",
        "spec": {
          "display": {
            "name": "Validation",
            "description": "Rate of XDS push operations, by type. This is incremented on a per-proxy basis.\n"
          },
          "plugin": {
            "kind": "TimeSeriesChart",
            "spec": {
              "legend": {
                "mode": "list",
                "position": "bottom",
                "values": []
              },
              "visual": {
                "areaOpacity": 0.1,
                "connectNulls": false,
                "display": "line",
                "lineWidth": 1
              }
            }
          },
          "queries": [
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "query": "sum (rate(galley_validation_passed[$__rate_interval]))",
                    "seriesNameFormat": "Success"
                  }
                }
              }
            },
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "query": "sum (rate(galley_validation_failed[$__rate_interval]))",
                    "seriesNameFormat": "Failure"
                  }
                }
              }
            }
          ]
        }
      },
      "3_1": {
        "kind": "Panel",
        "spec": {
          "display": {
            "name": "Injection",
            "description": "Size of each xDS push.\n"
          },
          "plugin": {
            "kind": "TimeSeriesChart",
            "spec": {
              "legend": {
                "mode": "list",
                "position": "bottom",
                "values": []
              },
              "visual": {
                "areaOpacity": 0.1,
                "connectNulls": false,
                "display": "line",
                "lineWidth": 1
              }
            }
          },
          "queries": [
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "query": "sum (rate(sidecar_injection_success_total[$__rate_interval]))",
                    "seriesNameFormat": "Success"
                  }
                }
              }
            },
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource",
                      "name": "$datasource"
                    },
                    "query": "sum (rate(sidecar_injection_failure_total[$__rate_interval]))",
                    "seriesNameFormat": "Failure"
                  }
                }
              }
            }
          ]
        }
      },
      "PushTime": {
        "kind": "Panel",
        "spec": {
          "display": {
            "name": "Push Time",
            "description": "Count of active and pending proxies managed by each instance. Pending is expected to converge to zero."
          },
          "plugin": {
            "kind": "TimeSeriesChart",
            "spec": {}
          },
          "queries": [
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "query": "sum(rate(pilot_xds_push_time_bucket{}[1m])) by (le)",
                    "seriesNameFormat": "{{le}}"
                  }
                }
              }
            }
          ]
        }
      },
      "PushSize": {
        "kind": "Panel",
        "spec": {
          "display": {
            "name": "Push Size",
            "description": "Size of each xDS push."
          },
          "plugin": {
            "kind": "TimeSeriesChart",
            "spec": {}
          },
          "queries": [
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "query": "sum(rate(pilot_xds_config_size_bytes_bucket{}[1m])) by (le)",
                    "seriesNameFormat": "{{le}}"
                  }
                }
              }
            }
          ]
        }
      }
    },
    "layouts": [
      {
        "kind": "Grid",
        "spec": {
          "display": {
            "title": "Deployed Versions",
            "collapse": {
              "open": true
            }
          },
          "items": [
            {
              "x": 0,
              "y": 0,
              "width": 24,
              "height": 5,
              "content": {
                "$ref": "#/spec/panels/0_0"
              }
            }
          ]
        }
      },
      {
        "kind": "Grid",
        "spec": {
          "display": {
            "title": "Resource Usage",
            "collapse": {
              "open": true
            }
          },
          "items": [
            {
              "x": 0,
              "y": 0,
              "width": 6,
              "height": 10,
              "content": {
                "$ref": "#/spec/panels/1_0"
              }
            },
            {
              "x": 6,
              "y": 0,
              "width": 6,
              "height": 10,
              "content": {
                "$ref": "#/spec/panels/1_1"
              }
            },
            {
              "x": 12,
              "y": 0,
              "width": 6,
              "height": 10,
              "content": {
                "$ref": "#/spec/panels/1_2"
              }
            },
            {
              "x": 18,
              "y": 0,
              "width": 6,
              "height": 10,
              "content": {
                "$ref": "#/spec/panels/1_3"
              }
            }
          ]
        }
      },
      {
        "kind": "Grid",
        "spec": {
          "display": {
            "title": "Push Information",
            "collapse": {
              "open": true
            }
          },
          "items": [
            {
              "x": 0,
              "y": 0,
              "width": 8,
              "height": 10,
              "content": {
                "$ref": "#/spec/panels/2_0"
              }
            },
            {
              "x": 8,
              "y": 0,
              "width": 8,
              "height": 10,
              "content": {
                "$ref": "#/spec/panels/2_1"
              }
            },
            {
              "x": 16,
              "y": 0,
              "width": 8,
              "height": 10,
              "content": {
                "$ref": "#/spec/panels/2_2"
              }
            },
            {
              "x": 0,
              "y": 10,
              "width": 8,
              "height": 10,
              "content": {
                "$ref": "#/spec/panels/2_3"
              }
            },
            {
              "x": 8,
              "y": 10,
              "width": 8,
              "height": 10,
              "content": {
                "$ref": "#/spec/panels/PushTime"
              }
            },
            {
              "x": 16,
              "y": 10,
              "width": 8,
              "height": 10,
              "content": {
                "$ref": "#/spec/panels/PushSize"
              }
            }
          ]
        }
      },
      {
        "kind": "Grid",
        "spec": {
          "display": {
            "title": "Webhooks",
            "collapse": {
              "open": true
            }
          },
          "items": [
            {
              "x": 0,
              "y": 0,
              "width": 12,
              "height": 8,
              "content": {
                "$ref": "#/spec/panels/3_0"
              }
            },
            {
              "x": 12,
              "y": 0,
              "width": 12,
              "height": 8,
              "content": {
                "$ref": "#/spec/panels/3_1"
              }
            }
          ]
        }
      }
    ],
    "variables": [
      {
        "kind": "ListVariable",
        "spec": {
          "display": {
            "hidden": false
          },
          "defaultValue": "PBFA97CFB590B2093",
          "allowAllValue": false,
          "allowMultiple": false,
          "plugin": {
            "kind": "DatasourceVariable",
            "spec": {
              "datasourcePluginKind": "prometheus"
            }
          },
          "name": "datasource"
        }
      }
    ],
    "duration": "1h",
    "refreshInterval": "0s"
  }
}